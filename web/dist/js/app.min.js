!function(e){window.MiitComponents={},window.MiitApp=function(){var e="0.0.0";return{VERSION:e,request:{}}}(),MiitApp.request.team=function(){"use strict";var e={};return e.users=function(e){MiitApp.utils.ajax.send("/app/team/users",e)},e.invite=function(e,t){MiitApp.utils.ajax.crsf("registration",function(a){MiitApp.utils.ajax.send("/app/team/invite",{email:e,_token:a},t)})},e}(),MiitApp.request.user=function(){"use strict";var e={};return e.change_password=function(e,t,a){MiitApp.utils.ajax.crsf("change_password",function(i){MiitApp.utils.ajax.send("/app/user/change_password",{password_old:e,password_new:{first:t,second:t},_token:i},a)})},e.promote=function(e,t,a){MiitApp.utils.ajax.crsf("promote_user",function(i){MiitApp.utils.ajax.send("/app/user/promote",{id:e,roles:t,_token:i},a)})},e.demote=function(e,t,a){MiitApp.utils.ajax.crsf("demote_user",function(i){MiitApp.utils.ajax.send("/app/user/demote",{id:e,roles:t,_token:i},a)})},e.remove=function(e,t){MiitApp.utils.ajax.crsf("remove_user",function(a){MiitApp.utils.ajax.send("/app/user/remove",{id:e,_token:a},t)})},e.registration=function(e,t,a){MiitApp.utils.ajax.crsf("registration",function(i){MiitApp.utils.ajax.send("/register",{user:{email:e},team:{name:t},terms:!0,_token:i},a)})},e}(),MiitApp.utils=function(){"use strict";function e(){for(var e=!1,t=0;t<r.length;t++){try{e=r[t]()}catch(a){continue}break}return e}var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i,a=/^[a-z0-9]{4,}$/i,i=/^.{6,32}$/,s=function(e){return function(t){return e.test(t)}},n=function(e){return function(t){return t||(t=MiitCurrentUser),t.roles.indexOf(e)>=0}},l=function(e){return MiitCurrentUser.id===((e||{}).id||null)},r=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],o=function(t,a,i){var s=e();if(s){"function"==typeof a&&(i=a,a=null);var n=a?"POST":"GET";s.open(n,t,!0),a&&s.setRequestHeader("Content-type","application/json"),s.onreadystatechange=function(){if(4==s.readyState&&(200==s.status||304==s.status)){var e;try{e=JSON.parse(s.responseText)}catch(t){}"function"==typeof i&&i(e)}},4!=s.readyState&&s.send(JSON.stringify(a))}},m=function(e,t){"function"==typeof e&&(t=e,e=null);var a="/_crsftoken/"+(e||"");o(a,function(e){e&&e.token&&"function"==typeof t&&t(e.token)})};return{ajax:{send:o,crsf:m},user:{isAdmin:n("ADMIN"),isUser:n("USER"),isOwner:n("OWNER"),isItMe:l},validator:{email:s(t),password:s(i),team:s(a)}}}(),MiitComponents.TeamApp=e.createClass({displayName:"TeamApp",render:function(){return e.createElement("div",{className:"page bg-grey lighten-5"},e.createElement(MiitComponents.MenuTeam,null),e.createElement(MiitComponents.ChangePassword,null),e.createElement("div",{className:"main"},e.createElement(MiitComponents.MiitTeamHeader,null),e.createElement(MiitComponents.MiitTeamContent,null)))}}),MiitComponents.ChangePassword=e.createClass({displayName:"ChangePassword",getDefaultProps:function(){return{placeholder:{old:MiitTranslator.get("placeholder.your.password","inputs"),first:MiitTranslator.get("placeholder.password.first","inputs"),second:MiitTranslator.get("placeholder.password.second","inputs")},submit:MiitTranslator.get("submit.change.password","inputs")}},getInitialState:function(){var e=this.getDefaultErrors();return e.value_old="",e.value_first="",e.value_second="",e},getDefaultErrors:function(){return{missing_old:!1,missing_first:!1,missing_second:!1,invalid_old:!1,invalid_same:!1,invalid_repeated:!1,invalid_format:!1}},handleChange:function(e){if(e.target&&e.target.name){var t={},a="value_"+e.target.name,i=e.target.value||"";t[a]=i,this.setState(t)}},handleSubmit:function(e){e.preventDefault();var t=this.state.value_old,a=this.state.value_first,i=this.state.value_second;return this.setState(this.getDefaultErrors()),t&&a&&i?a!==i?void this.setState({invalid_repeated:!0}):a===t?void this.setState({invalid_same:!0}):MiitApp.utils.validator.password(a)?void MiitApp.request.user.change_password(t,a,function(){this.setState({value_old:"",value_first:"",value_second:""})}.bind(this)):void this.setState({invalid_format:!0}):void this.setState({missing_old:!t,missing_first:!a,missing_second:!i})},render:function(){var t=e.addons.classSet,a=this.state.value_old,i=t({invalid:this.state.missing_old||this.state.invalid_old}),s=this.state.value_first,n=t({invalid:this.state.missing_first||this.state.invalid_same||this.state.invalid_format}),l=this.state.value_second,r=t({invalid:this.state.missing_second||this.state.invalid_repeated});return e.createElement("form",{className:"miit-component change-password",onSubmit:this.handleSubmit},e.createElement("div",null,e.createElement("input",{type:"password",className:i,value:a,placeholder:this.props.placeholder.old,onChange:this.handleChange,name:"old"}),e.createElement("input",{type:"password",className:n,value:s,placeholder:this.props.placeholder.first,onChange:this.handleChange,name:"first"}),e.createElement("input",{type:"password",className:r,value:l,placeholder:this.props.placeholder.second,onChange:this.handleChange,name:"second"}),e.createElement("input",{type:"submit",value:this.props.submit})))}}),MiitComponents.UserListHeader=e.createClass({displayName:"UserListHeader",getDefaultProps:function(){return{title:{name:"Name",action:"Action"}}},render:function(){var t=null;return MiitApp.utils.user.isAdmin()&&(t=e.createElement("span",null,this.props.title.action)),e.createElement("div",{className:"miit-component user-list-header"},e.createElement("span",null,this.props.title.name),t)}}),MiitComponents.UserListInvite=e.createClass({displayName:"UserListInvite",getDefaultProps:function(){return{placeholder:{email:MiitTranslator.get("placeholder.email.invite","inputs")},submit:MiitTranslator.get("submit.invite.user","inputs")}},getInitialState:function(){var e=this.getDefaultErrors();return e.email="",e},getDefaultErrors:function(){return{missing_email:!1,invalid_email:!1}},handleChange:function(e){this.setState({email:e.trim()})},handleSubmit:function(e){e.preventDefault();var t=this.state.email;return this.setState(this.getDefaultErrors()),MiitApp.utils.user.isAdmin()?t?MiitApp.utils.validator.email(t)?void MiitApp.request.team.invite(t,function(){this.setState({email:""}),"function"==typeof this.props.onInvite&&this.props.onInvite(t)}.bind(this)):void this.setState({invalid_email:!0}):void this.setState({missing_email:!0}):void 0},render:function(){if(!MiitApp.utils.user.isAdmin())return null;var t=e.addons.classSet,a=t({invalid:this.state.missing_email||this.state.invalid_email}),i={value:this.state.email,requestChange:this.handleChange};return e.createElement("div",{className:"miit-component user-list-invite"},e.createElement("form",{onSubmit:this.handleSubmit},e.createElement("input",{type:"text",className:a,placeholder:this.props.placeholder.email,valueLink:i}),e.createElement("input",{type:"submit",value:this.props.submit})))}}),MiitComponents.UserListItemRoles=e.createClass({displayName:"UserListItemRoles",getDefaultProps:function(){return{text:{admin:MiitTranslator.get("user-list.actions.admin","team"),user:MiitTranslator.get("user-list.actions.user","team"),remove:MiitTranslator.get("user-list.actions.remove","team")},user:{id:"",roles:[]}}},getInitialState:function(){return{loading:!1}},onAction:function(){this.setState({loading:!1}),"function"==typeof this.props.onAction&&this.props.onAction()},toggleRole:function(e){var t="promote";this.props.user.roles.indexOf(e)>=0&&(t="demote"),MiitApp.request.user[t](this.props.user.id,[e],this.onAction)},handleClick:function(e,t){if(t.preventDefault(),!this.state.loading){var a=MiitApp.utils.user.isAdmin(),i=MiitApp.utils.user.isOwner(this.props.user),s=MiitApp.utils.user.isAdmin(this.props.user),n=MiitApp.utils.user.isItMe(this.props.user);if(!(!a||n||i||"REMOVE"===e&&s))switch(this.setState({loading:!0}),e){case"ADMIN":case"USER":this.toggleRole(e);break;case"REMOVE":MiitApp.request.user.remove(this.props.user.id,this.onAction)}}},render:function(){var t=e.addons.classSet,a=MiitApp.utils.user.isAdmin(),i=MiitApp.utils.user.isAdmin(this.props.user),s=MiitApp.utils.user.isUser(this.props.user),n=MiitApp.utils.user.isItMe(this.props.user),l=t({disable:!a||n||i,active:s}),r=t({disable:!a||n,active:i}),o=t({disable:!a||n||i});return e.createElement("span",{className:"miit-component user-list-item-roles"},e.createElement("span",{onClick:this.handleClick.bind(this,"USER"),className:l},this.props.text.user),e.createElement("span",{onClick:this.handleClick.bind(this,"ADMIN"),className:r},this.props.text.admin),e.createElement("span",{onClick:this.handleClick.bind(this,"REMOVE"),className:o},this.props.text.remove))}}),MiitComponents.UserListItem=e.createClass({displayName:"UserListItem",getDefaultProps:function(){return{user:{id:"",name:"unknow",roles:[]}}},render:function(){return e.createElement("div",{className:"miit-component user-list-item"},e.createElement("span",null,this.props.user.name),e.createElement(MiitComponents.UserListItemRoles,{user:this.props.user,onAction:this.props.onEdit}))}}),MiitComponents.UserList=e.createClass({displayName:"UserList",getDefaultProps:function(){return{users:[],autoload:!1,loading:MiitTranslator.get("loading","team")}},getInitialState:function(){return{loaded:!1}},refresh:function(){this.props.autoload&&!this.state.loaded&&MiitApp.request.team.users(function(e){this.props.users=e,this.setState({loaded:!0})}.bind(this))},allowRefresh:function(){this.setState({loaded:!1})},render:function(){this.refresh();var t=null;return this.props.autoload&&!this.state.loaded&&(t=e.createElement("div",null,this.props.loading)),e.createElement("div",{className:"miit-component user-list"},e.createElement(MiitComponents.UserListHeader,null),this.props.users.map(function(t){return e.createElement(MiitComponents.UserListItem,{user:t,onEdit:this.allowRefresh})}.bind(this)),t,e.createElement(MiitComponents.UserListInvite,{onInvite:this.allowRefresh}))}}),MiitComponents.MenuTeam=e.createClass({displayName:"MenuTeam",render:function(){return e.createElement("div",{className:"sidr-left bg-blue-grey"},e.createElement("div",{className:"sl-wrapper"},e.createElement("a",{className:"sl-header bg-blue-grey darken-1"},e.createElement("i",{className:"fa fa-bars pull-left"}),"Menu",e.createElement("i",{className:"fa fa-angle-down pull-right"})),e.createElement("span",{className:"sl-label"},e.createElement("i",{className:"mdi-action-favorite pull-left"})," Favorites"),e.createElement("ul",{className:"sl-list"},e.createElement("li",null,e.createElement("a",null,e.createElement("i",{className:"fa fa-weixin pull-left"}),"Chat miit")),e.createElement("li",null,e.createElement("a",null,e.createElement("i",{className:"fa fa-question pull-left"}),"Quizz : Que pensez-vous..."))),e.createElement("span",{className:"sl-label"},e.createElement("i",{className:"fa fa-map-marker pull-left"})," Miits"),e.createElement("ul",{className:"sl-list"},e.createElement("li",null,e.createElement("a",{className:"active"},e.createElement("i",{className:"fa fa-circle-thin pull-left stat-open"})," Miit ouvert")),e.createElement("li",null,e.createElement("a",null,e.createElement("i",{className:"fa fa-circle-thin pull-left stat-ready"})," Miit prêt")),e.createElement("li",null,e.createElement("a",null,e.createElement("i",{className:"fa fa-circle-thin pull-left stat-config"})," Miit en configuration")),e.createElement("li",null,e.createElement("a",null,e.createElement("i",{className:"fa fa-plus pull-left"})," Créer un Miit"))),e.createElement("a",{className:"sl-footer"},e.createElement("div",{className:"avatar border-circle"},e.createElement("img",{src:"http://www.mangashare.com/forums/customavatars/avatar68124_1.gif"})),e.createElement("span",null,"John Random",e.createElement("i",{className:"fa fa-angle-up pull-right"})))))}}),MiitComponents.MiitTeamContent=e.createClass({displayName:"MiitTeamContent",render:function(){return e.createElement("div",{className:"page-content page-dashboard"},e.createElement("div",{className:"container"},e.createElement("h1",{className:"mb30"},"Dashboard"),e.createElement("h2",null,"Configuration"),e.createElement("h3",{className:"mt30 mb30"},e.createElement("i",{className:"fa fa-lock pull-left "})," Confidentialité"),e.createElement("div",{className:"mb20"},e.createElement("div",{className:"checkbox-field mb20"},e.createElement("label",null,e.createElement("input",{type:"radio",name:"confid",className:"option-input radio",defaultChecked:!0}),"Publique")),e.createElement("p",{className:"mb10"},"Votre Miit est publique et accessible a tout le monde via l URL :"),e.createElement("div",{className:"input-field pure-u-sm-1-3 mb20"},e.createElement("input",{value:"https://sncf.miit.fr/XBM56T",type:"text",disabled:!0}))),e.createElement("div",{className:"mb20"},e.createElement(MiitComponents.UserList,{autoload:!0})),e.createElement("div",{className:"checkbox-field mb20"},e.createElement("label",null,e.createElement("input",{type:"radio",name:"confid",className:"option-input radio"}),"Privé")),e.createElement("p",{className:"mb10"},"Votre Miit est privé et ne sera accessible qu aux personnes de votre choix"),e.createElement("div",{className:"input-field pure-u-sm-1-3"},e.createElement("i",{className:"fa fa-user-plus"}),e.createElement("input",{placeholder:"Ajoutez une personne ou un cercle",type:"text"})),e.createElement("h3",{className:"mt30 mb30"},e.createElement("i",{className:"fa fa-info pull-left "})," Informations"),e.createElement("div",{className:"input-field pure-u-sm-1-2 mb30"},e.createElement("label",null,"Titre"),e.createElement("input",{placeholder:"Titre",id:"title",type:"text",value:"Miit ouvert"})),e.createElement("div",{className:"input-field pure-u-sm-2-3"},e.createElement("label",null,"Description"),e.createElement("textarea",{placeholder:"Description",rows:"6"},"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. ")),e.createElement("h3",{className:"mt30"},e.createElement("i",{className:"fa fa-circle-thin pull-left stat-open"})," Status"),e.createElement("p",{className:"mt30 mb30"},e.createElement("i",{className:"fa fa-info pull-left"})," Votre Miit est ouvert est prêt à être utilisé"),e.createElement("button",{className:"btn mr20"},"Ouvert"),e.createElement("button",{className:"btn btn-warning mr20"},"Fermer"),e.createElement("button",{className:"btn btn-danger mr20"},"Supprimer"),e.createElement("h2",{className:"mt30"},"Applications")),e.createElement("ul",{className:"app-list"},e.createElement("li",null,e.createElement("a",null,e.createElement("i",{className:"fa fa-weixin bg-blue"}),e.createElement("span",null,"Chat"))),e.createElement("li",null,e.createElement("a",null,e.createElement("i",{className:"fa fa-question bg-green"}),e.createElement("span",null,"Quizz"))),e.createElement("li",null,e.createElement("a",{className:"add-app"},e.createElement("i",{className:"fa fa-plus bg-blue-grey"}),e.createElement("span",null,"Ajouter une App")))))}}),MiitComponents.MiitTeamHeader=e.createClass({displayName:"MiitTeamHeader",render:function(){return e.createElement("div",{className:"page-header z-depth-1"},e.createElement("h1",null,e.createElement("i",{className:"fa fa-circle-thin pull-left stat-open"})," Miit ouvert ",e.createElement("a",{className:"ph-title"},e.createElement("i",{className:"fa fa-cog pull-right"}))),e.createElement("ul",{className:"ph-btn-list"},e.createElement("li",{className:"active"},e.createElement("a",null,e.createElement("i",{className:"fa fa-question pull-left"}),"Quizz ",e.createElement("span",null,"Que pensez-vous de...")," ",e.createElement("i",{className:"fa fa-times pull-right"}))),e.createElement("li",null,e.createElement("a",null,e.createElement("i",{className:"fa fa-weixin"}),"Chat",e.createElement("i",{className:"fa fa-times pull-right"}))),e.createElement("li",null,e.createElement("a",null,e.createElement("i",{className:"fa fa-plus pull-left"})," Ajouter"))))}}),MiitComponents.CreateTeam=e.createClass({displayName:"CreateTeam",getDefaultProps:function(){return{placeholder:{email:MiitTranslator.get("placeholder.your.email","inputs"),team:MiitTranslator.get("placeholder.team.name","inputs")},submit:MiitTranslator.get("submit.create.team","inputs")}},getInitialState:function(){return this.getDefaultErrors()},getDefaultErrors:function(){return{missing_email:!1,missing_team:!1,missing_terms:!1,invalid_email:!1,invalid_team:!1}},handleSubmit:function(t){t.preventDefault();var a=e.findDOMNode(this.refs.email).value.trim(),i=e.findDOMNode(this.refs.team).value.trim(),s=e.findDOMNode(this.refs.terms).checked;return this.setState(this.getDefaultErrors()),a&&i&&s?MiitApp.utils.validator.email(a)?MiitApp.utils.validator.team(i)?void MiitApp.request.user.registration(a,i,function(e){console.log(e)}):void this.setState({invalid_team:!0}):void this.setState({invalid_email:!0}):void this.setState({missing_email:!a,missing_team:!i,missing_terms:!s})},render:function(){var t=e.addons.classSet,a=t({invalid:this.state.missing_email||this.state.invalid_email}),i=t({invalid:this.state.missing_team||this.state.invalid_team}),s=t({invalid:this.state.missing_terms});return e.createElement("form",{className:"miit-component create-team",onSubmit:this.handleSubmit},e.createElement("div",null,e.createElement("input",{type:"text",className:a,placeholder:this.props.placeholder.email,ref:"email"}),e.createElement("input",{type:"text",className:i,placeholder:this.props.placeholder.team,ref:"team"}),e.createElement("input",{type:"checkbox",className:s,ref:"terms"}),e.createElement("input",{type:"submit",value:this.props.submit})))}})}(React);
//# sourceMappingURL=app.min.js.map